<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <select id="year-select">
        <option value="2014">2014</option>
        <option value="2015">2015</option>
        <option value="2016">2016</option>
        <option value="2017">2017</option>
        <option value="2018">2018</option>
        <option value="2019">2019</option>
        <option value="2020">2020</option>
        <option value="2021">2021</option>
        <option value="2022">2022</option>
        <option value="2023">2023</option>
        <option value="2024">2024</option>
        <option value="2025">2025</option>
    </select>
    
    <select id="month-select">
        <option value="1">01</option>
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
    </select>
    
    <select id="day-select"><option value="1">01</option>
        <option value="2">02</option>
        <option value="3">03</option>
        <option value="4">04</option>
        <option value="5">05</option>
        <option value="6">06</option>
        <option value="7">07</option>
        <option value="8">08</option>
        <option value="9">09</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
        <option value="13">13</option>
        <option value="14">14</option>
        <option value="15">15</option>
        <option value="16">16</option>
        <option value="17">17</option>
        <option value="18">18</option>
        <option value="19">19</option>
        <option value="20">20</option>
        <option value="21">21</option>
        <option value="22">22</option>
        <option value="23">23</option>
        <option value="24">24</option>
        <option value="25">25</option>
        <option value="26">26</option>
        <option value="27">27</option>
        <option value="28">28</option>
        <option value="29">29</option>
        <option value="30">30</option>
        <option value="31">31</option>
    </select>

    <select id="hour-select">
    <option value="0">00</option>
    <option value="1">01</option>
    <option value="2">02</option>
    <option value="3">03</option>
    <option value="4">04</option>
    <option value="5">05</option>
    <option value="6">06</option>
    <option value="7">07</option>
    <option value="8">08</option>
    <option value="9">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    </select>

    <select id="minite-select">
    <option value="0">00</option>
    <option value="1">01</option>
    <option value="2">02</option>
    <option value="3">03</option>
    <option value="4">04</option>
    <option value="5">05</option>
    <option value="6">06</option>
    <option value="7">07</option>
    <option value="8">08</option>
    <option value="9">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
    </select>

    <select id="second-select">
    <option value="0">00</option>
    <option value="1">01</option>
    <option value="2">02</option>
    <option value="3">03</option>
    <option value="4">04</option>
    <option value="5">05</option>
    <option value="6">06</option>
    <option value="7">07</option>
    <option value="8">08</option>
    <option value="9">09</option>
    <option value="10">10</option>
    <option value="11">11</option>
    <option value="12">12</option>
    <option value="13">13</option>
    <option value="14">14</option>
    <option value="15">15</option>
    <option value="16">16</option>
    <option value="17">17</option>
    <option value="18">18</option>
    <option value="19">19</option>
    <option value="20">20</option>
    <option value="21">21</option>
    <option value="22">22</option>
    <option value="23">23</option>
    <option value="24">24</option>
    <option value="25">25</option>
    <option value="26">26</option>
    <option value="27">27</option>
    <option value="28">28</option>
    <option value="29">29</option>
    <option value="30">30</option>
    <option value="31">31</option>
    <option value="32">32</option>
    <option value="33">33</option>
    <option value="34">34</option>
    <option value="35">35</option>
    <option value="36">36</option>
    <option value="37">37</option>
    <option value="38">38</option>
    <option value="39">39</option>
    <option value="40">40</option>
    <option value="41">41</option>
    <option value="42">42</option>
    <option value="43">43</option>
    <option value="44">44</option>
    <option value="45">45</option>
    <option value="46">46</option>
    <option value="47">47</option>
    <option value="48">48</option>
    <option value="49">49</option>
    <option value="50">50</option>
    <option value="51">51</option>
    <option value="52">52</option>
    <option value="53">53</option>
    <option value="54">54</option>
    <option value="55">55</option>
    <option value="56">56</option>
    <option value="57">57</option>
    <option value="58">58</option>
    <option value="59">59</option>
    </select>

    <div id="display" ></div>
    <p id="result-wrapper"></p>

    <script>

    var mytimer = setInterval(getTime,1000);
    var cdtimer = setInterval(getCD,1000);
    var timestring = "";
    var targetstring = "";
    var cdstring = "";
    var display = document.getElementById("display");
    var cddisplay = document.getElementById("result-wrapper");
    var selectList = document.querySelectorAll("select");
    var dayselect = document.querySelector("#day-select");
    var initialdaylist = dayselect.querySelectorAll("option");
    var daysinthemonth ;
    for (let index = 0; index < selectList.length; index++) {
        const element = selectList[index];
        if (index <= 1) {
            element.addEventListener("blur",daylistShow)//只有年月改变，才会倒是当月天数变化
        }
        element.addEventListener("blur",getTargetTime);
    }
    //时钟函数
    function getTime(){
        var mydate = new Date();
        var y = mydate.getFullYear();
        var month = mydate.getMonth()+1;
        var date = mydate.getDate();
        var day = getMyDay(mydate);
        var h = mydate.getHours();
        var m = mydate.getMinutes();
        var s = mydate.getSeconds();
        month = checkTime(month);
        date = checkTime(date);
        m = checkTime(m);
        s = checkTime(s);
        timestring = "现在是北京时间："+y+"年"+month+"月"+date+"日 星期"+day+" "+h+":"+m+":"+s;
        display.innerHTML = timestring;
        return y + '-' + month + '-' + date+' '+h+':'+m+':'+ s;  
    }
    //单位数补零
    function checkTime(t){
        if (t<10) { 
            t= "0"+t;
        }
        return t;
    }
    //星期显示修正
    function getMyDay(date){
        var daylist = ["日","一","二","三","四","五","六"];
        return daylist[date.getDay()];
    }
    //根据年月返回当月天数
    function getDays(year,month){
        var d = new Date(year,month,0);
        return d.getDate();
    }

    //当月可选天数修正
    function daylistShow(){
        getTargetTime();
        var nowdaylist = dayselect.querySelectorAll("option");
        if (daysinthemonth < nowdaylist.length) {
            for (let index = nowdaylist.length; index > daysinthemonth; index--) {
            dayselect.removeChild(initialdaylist[index-1]);
            }
        }else if(daysinthemonth > nowdaylist.length){
            for (let index = nowdaylist.length; index <= daysinthemonth; index++) {
            dayselect.appendChild(initialdaylist[index-1]);
            }
        }

    }

    //设定目标时间
    function getTargetTime(){
        var y = selectList[0].value;
        var month = selectList[1].value;
        daysinthemonth=getDays(y,month);
        var date = selectList[2].value;
        var str = ""+y+"-"+month+"-"+date;
        var newdate = new Date(Date.parse(str.replace(/\-/g,"/")));
        var day = getMyDay(newdate);
        var h = selectList[3].value;
        var m = selectList[4].value;
        var s = selectList[5].value;
        month = checkTime(month);
        date = checkTime(date);
        m = checkTime(m);
        s = checkTime(s);
        targetstring = y+"年"+month+"月"+date+"日 星期"+day+" "+h+":"+m+":"+s;

        return y + '-' + month + '-' + date+' '+h+':'+m+':'+ s;  
    }

    //倒计时函数
    function getCD(){
        var dateBegin;
        var dateEnd;
        var isPassed;

        var dateNow = new Date(getTime());
        var dateTarget = new Date(getTargetTime());
        if (dateNow < dateTarget) {
            dateBegin = dateNow;
            dateEnd = dateTarget;
            isPassed = false;
        }else{
            dateBegin = dateTarget;
            dateEnd = dateNow;
            isPassed = true;
        }

        var dateDiff = dateEnd.getTime() - dateBegin.getTime();//时间差的毫秒数
        var dayDiff = Math.floor(dateDiff / (24 * 3600 * 1000));//计算出相差天数
        var leave1=dateDiff%(24*3600*1000)    //计算天数后剩余的毫秒数
        var hours=Math.floor(leave1/(3600*1000))//计算出小时数
        //计算相差分钟数
        var leave2=leave1%(3600*1000)    //计算小时数后剩余的毫秒数
        var minutes=Math.floor(leave2/(60*1000))//计算相差分钟数
        //计算相差秒数
        var leave3=leave2%(60*1000)      //计算分钟数后剩余的毫秒数
        var seconds=Math.round(leave3/1000)
        var isPassedStr="还有";
        if (isPassed) {
            isPassedStr = "已经过去"
        }

        cddisplay.innerHTML = "现在距离"+targetstring+" "+isPassedStr+" "+dayDiff+" 天 "+hours+" 小时 "+minutes+" 分 "+seconds+" 秒"
    }

    </script>
</body>
</html>